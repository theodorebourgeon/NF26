In [1]: def limgen(gen,limit):
   ...:     for i,d in enumerate(gen):
   ...:         if i >=limit:
   ...:             return None
   ...:         yield d
   ...:

In [2]: import loadData

In [4]: D1 = sc.parallelize(limgen(loadData.loadataDirectory("./data/201307-201402-citibike-tripdata"
   ...: ), 100000))
2013-08 - Citi Bike trip data.csv

In [5]: D1
Out[5]: ParallelCollectionRDD[0] at parallelize at PythonRDD.scala:195

In [6]: D1.take(1)
19/06/13 11:02:07 WARN TaskSetManager: Stage 0 contains a task of very large size (2547 KB). The maximum recommended task size is 100 KB.
Out[6]:
[{'tripduration': 664,
  'starttime': (2013, 8, 1, 0, 0, 0.0),
  'stoptime': (2013, 8, 1, 0, 11, 4.0),
  'start station name': 'W 52 St & 9 Ave',
  'start station latitude': 40.76461837,
  'start station longitude': -73.98789473,
  'stop station name': '9 Ave & W 45 St',
  'stop station latitude': 40.76019252,
  'stop station longitude': -73.9912551,
  'bikeid': 20068,
  'usertype': 'Subscriber',
  'birth year': 1980,
  'gender': 1}]

In [7]: def mapQ1(d):
   ...:     return (d['starttime'][3], (1,d['tripduration'],d['tripduration']**2, d['starttime'][3], d['starttime'][3]))
   ...:

In [8]: def reductionQ1(x,y):
   ...:     return x[0]+y[0], x[1]+y[1], x[2]+y[2], min(x[1],y[1]), max(x[1],y[1])
   ...:

In [9]: def map2Q1(d):
   ...:     (k, (s0,s1,s2,min1,max1))= d
   ...:     return (k, s1/s0, (s2/s0 -s1/s0), min1, max1)
   ...:

In [10]: DQ1 = D1.map(mapQ1).reduceByKey(reductionQ1).map(map2Q1)

In [11]: DQ1.take(10)
19/06/13 11:19:35 WARN TaskSetManager: Stage 1 contains a task of very large size (2547 KB). The maximum recommended task size is 100 KB.
Out[11]:
[(0, 928.3204279164544, 3296181.646459501, 682174, 1140119),
 (8, 865.3189643107067, 2709226.794121763, 543779, 5638925),
 (16, 1063.0859792518077, 2698432.3662370327, 3337972, 3425381),
 (1, 1032.5410235580828, 8073353.980503656, 512895, 758163),
 (9, 876.1568938193344, 2172040.4684627578, 972420, 4556130),
 (17, 995.6725074037512, 2571719.4755676207, 1647111, 6421819),
 (2, 1026.6874236874237, 7250239.504273504, 350013, 490844),
 (10, 1019.7542074363993, 3094481.541291585, 1776002, 3434942),
 (18, 1053.2575178997613, 8007149.340095466, 3198437, 5627861),
 (3, 976.2490421455939, 4698143.605363985, 84625, 424977)]

 In [15]: DQ1.collect()
Out[15]:
[(0, 928.3204279164544, 3296181.646459501, 682174, 1140119),
 (8, 865.3189643107067, 2709226.794121763, 543779, 5638925),
 (16, 1063.0859792518077, 2698432.3662370327, 3337972, 3425381),
 (1, 1032.5410235580828, 8073353.980503656, 512895, 758163),
 (9, 876.1568938193344, 2172040.4684627578, 972420, 4556130),
 (17, 995.6725074037512, 2571719.4755676207, 1647111, 6421819),
 (2, 1026.6874236874237, 7250239.504273504, 350013, 490844),
 (10, 1019.7542074363993, 3094481.541291585, 1776002, 3434942),
 (18, 1053.2575178997613, 8007149.340095466, 3198437, 5627861),
 (3, 976.2490421455939, 4698143.605363985, 84625, 424977),
 (11, 1079.1860936923645, 3306486.978974548, 2510748, 3340599),
 (19, 1010.6573936082133, 3613875.132306673, 2499732, 3603628),
 (4, 1076.286783042394, 4632232.194513716, 201747, 229844),
 (12, 1073.1656896019747, 3365631.899722308, 3264654, 3691606),
 (20, 1026.4097205346295, 6450273.546051033, 1805839, 2417837),
 (5, 785.7617107942973, 1270031.531568228, 58945, 326864),
 (13, 1094.815543071161, 3007490.936017478, 3362118, 3653460),
 (21, 1050.8338751625488, 6097299.673602081, 1278227, 1954138),
 (6, 771.7607602012297, 1340208.1006148688, 123077, 1257603),
 (14, 1103.9650872817956, 5649075.1953449715, 2239607, 4400743),
 (22, 1021.6590496916939, 5711305.617700399, 1115228, 1701486),
 (7, 801.2892067620286, 1875572.479583875, 214031, 2866926),
 (15, 1047.2979458629295, 2927250.656555961, 2564801, 2890574),
 (23, 1088.7072319201995, 10858960.64139651, 852751, 1330107)]